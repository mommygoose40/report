<!DOCTYPE html>
<html>
<head>
    <title>智慧錄音解決方案</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        /* 樣式保持不變 */
    </style>
</head>
<body>
    <div id="app">
        <h1>錄音功能</h1>
        <button id="record-btn">開始錄音</button>
        <div id="status"></div>
        <audio id="audio-playback" controls style="display:none;"></audio>
    </div>

    <script>
        const liffId = '2007934728-xN6aOL3D';
        
        liff.init({ liffId: liffId })
            .then(() => {
                if (!liff.isInClient()) {
                    showMessage('請在 LINE App 內使用此功能');
                    return;
                }
                
                if (!liff.isApiAvailable('recordAudio')) {
                    if (liff.getOS() === 'web') {
                        showMessage('電腦版 LINE 不支援錄音，請用手機開啟');
                    } else {
                        showMessage('請更新 LINE App 至最新版本');
                    }
                    return;
                }
                
                setupLIFFRecording();
            });

        function setupLIFFRecording() {
            document.getElementById('record-btn').addEventListener('click', async () => {
                try {
                    const recording = await liff.recordAudio({
                        maxDuration: 30,
                        title: '錄音授權',
                        message: '請允許麥克風權限'
                    });
                    playRecording(recording.url);
                } catch (err) {
                    showMessage('錄音失敗: ' + err.message);
                }
            });
        }

        function playRecording(url) {
            const audioPlayer = document.getElementById('audio-playback');
            audioPlayer.src = url;
            audioPlayer.style.display = 'block';
            showMessage('錄音完成！');
        }

        function showMessage(text) {
            document.getElementById('status').textContent = text;
        }
    </script>
</body>
</html>