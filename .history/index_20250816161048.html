<!DOCTYPE html>
<html>
<head>
    <title>灾情回報</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px; margin: 5px; }
        #audio-playback { margin-top: 15px; }
    </style>
</head>
<body>
    <h1>灾情回報</h1>
    
    <!-- 錄音區塊 -->
    <button id="record-btn">錄音說明</button>
    <div id="audio-status">（尚未錄音）</div>
    <audio id="audio-playback" controls style="display:none;"></audio>
    
    <!-- 文字摘要 -->
    <input type="text" id="summary" placeholder="20字摘要" required>
    <button id="submit-btn">提交</button>

    <script>
        // 初始化LIFF
        liff.init({ liffId: '2007934728-xN6aOL3D' })
            .then(() => {
                if (!liff.isLoggedIn()) liff.login();
                setupButtons();
            });

        function setupButtons() {
            // 錄音按鈕
            document.getElementById('record-btn').addEventListener('click', async () => {
                try {
                    const recording = await liff.record({
                        maxDuration: 30000, // 最長30秒
                        title: '災情語音說明',
                        message: '請描述災情狀況'
                    });
                    
                    // 顯示錄音結果
                    document.getElementById('audio-status').textContent = '✓ 已錄音';
                    const audioPlayer = document.getElementById('audio-playback');
                    audioPlayer.src = recording.value;
                    audioPlayer.style.display = 'block';
                    
                } catch (err) {
                    console.error('錄音失敗:', err);
                    alert(`錄音失敗: ${err.message}`);
                }
            });

            // 提交按鈕
            document.getElementById('submit-btn').addEventListener('click', () => {
                const summary = document.getElementById('summary').value;
                if (!summary) {
                    alert('請填寫文字摘要！');
                    return;
                }
                
                // 這裡需補充音檔上傳邏輯（見下方說明）
                submitData(summary);
            });
        }

        function submitData(summary) {
            fetch('https://script.google.com/.../exec', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    summary: summary,
                    audioUrl: document.getElementById('audio-playback').src || null
                })
            }).then(() => alert('回報成功！'))
              .catch(() => alert('提交失敗'));
        }
    </script>
</body>
</html>