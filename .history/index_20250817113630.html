<!DOCTYPE html>
<html>
<head>
    <title>錄音測試</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; text-align: center; }
        button { padding: 10px; margin: 10px; background: #06c755; color: white; border: none; }
        #audio-container { margin: 20px; }
    </style>
</head>
<body>
    <h1>錄音功能測試</h1>
    <button id="record-btn">開始錄音</button>
    <div id="status">準備就緒</div>
    <div id="audio-container">
        <audio id="audio-playback" controls style="display:none;"></audio>
    </div>
    <button id="submit-btn" style="display:none; background:#FF3333;">提交到Google Sheets</button>

    <script>
        // 替換成你的LIFF ID
        const liffId = '2007934728-xN6aOL3D';
        
        let audioBlob = null;
        
        liff.init({ liffId: liffId })
            .then(() => {
                if (!liff.isLoggedIn()) liff.login();
                setupButtons();
            });

        function setupButtons() {
            // 錄音按鈕
            document.getElementById('record-btn').addEventListener('click', async () => {
                try {
                    const recording = await liff.recordAudio({
                        maxDuration: 30,
                        title: '錄音測試',
                        message: '請說些什麼'
                    });
                    
                    document.getElementById('status').textContent = '錄音成功';
                    const audioPlayer = document.getElementById('audio-playback');
                    audioPlayer.src = recording.url;
                    audioPlayer.style.display = 'block';
                    audioBlob = recording.blob;
                    document.getElementById('submit-btn').style.display = 'inline-block';
                } catch (err) {
                    document.getElementById('status').textContent = '錄音失敗: ' + err.message;
                }
            });

            // 提交按鈕
            document.getElementById('submit-btn').addEventListener('click', async () => {
                try {
                    // 替換成你的Google Apps Script網頁應用程式URL
                    const scriptUrl = 'https://script.google.com/macros/s/AKfycbxxPnPQ7JkgASlIhZDSc2cjykYHH_mF046uTP0kJ71MGLxvphK5hJcTscb00ifehgVplw/exec';
                    
                    const response = await fetch(scriptUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: 'record_test',
                            audioUrl: document.getElementById('audio-playback').src,
                            timestamp: new Date().toISOString()
                        })
                    });
                    
                    const result = await response.json();
                    alert(result.status === 'success' ? '提交成功！' : '提交失敗');
                } catch (err) {
                    alert('提交錯誤: ' + err.message);
                }
            });
        }
    </script>
</body>
</html>