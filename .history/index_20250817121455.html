<!DOCTYPE html>
<html>
<head>
    <title>智慧錄音解決方案</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        body { font-family: Arial; max-width: 500px; margin: 0 auto; padding: 20px; text-align: center; }
        h1 { color: #06c755; }
        #record-btn {
            padding: 12px 24px;
            background: #06c755;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 20px 0;
            transition: background-color 0.3s;
        }
        #record-btn:disabled { background: #cccccc; cursor: not-allowed; }
        #status { margin: 15px 0; min-height: 24px; font-weight: bold; }
        #audio-playback { width: 100%; margin-top: 20px; display: none; }
        .error { color: #ff3333; }
        .success { color: #06c755; }
    </style>
</head>
<body>
    <div id="app">
        <h1>錄音功能測試</h1>
        <button id="record-btn">開始錄音</button>
        <div id="status">請點擊按鈕開始錄音</div>
        <audio id="audio-playback" controls></audio>
    </div>

    <script>
        // 請替換成您的 LIFF ID！
        const liffId = '2007934728-xN6aOL3D';
        
        liff.init({ 
            liffId: liffId,
            withLoginOnExternalBrowser: true  // 強制啟用錄音權限
        }).then(() => {
            if (!liff.isInClient()) throw new Error('請在手機LINE App內開啟');
            if (!liff.isApiAvailable('recordAudio')) throw new Error('不支援錄音功能');
            setupRecording();
        }).catch(err => {
            showMessage(err.message, 'error');
            document.getElementById('record-btn').disabled = true;
        });

        function setupRecording() {
            const recordBtn = document.getElementById('record-btn');
            recordBtn.addEventListener('click', async () => {
                try {
                    recordBtn.disabled = true;
                    showMessage('準備錄音中...');
                    
                    const recording = await liff.recordAudio({
                        maxDuration: 30,
                        title: '錄音測試',
                        message: '請說些什麼',
                        language: 'zh-TW'
                    });

                    showMessage('錄音成功！', 'success');
                    const audioPlayer = document.getElementById('audio-playback');
                    audioPlayer.src = recording.url;
                    audioPlayer.style.display = 'block';

                } catch (err) {
                    showMessage('失敗: ' + err.message, 'error');
                } finally {
                    recordBtn.disabled = false;
                }
            });
        }

        function showMessage(text, type = '') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = text;
            statusEl.className = type;
        }
    </script>
</body>
</html>