<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>災情回報</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #06c755;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        input {
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>災情回報</h1>
    
    <!-- 錄音按鈕 -->
    <button onclick="startRecording()">🎤 錄音</button>
    <br>
    
    <!-- 文字摘要輸入框 -->
    <input type="text" id="summary" placeholder="請輸入災情摘要（20字內）" maxlength="20">
    <br>
    
    <!-- 提交按鈕 -->
    <button onclick="submitForm()">📤 提交</button>

    <script>
        // LIFF 初始化
        liff.init({ liffId: '2007934728-xN6aOL3D' }) // 務必換成您的 LIFF ID
            .then(() => {
                console.log('LIFF 初始化成功');
                if (!liff.isLoggedIn()) {
                    liff.login(); // 如果未登入，導至登入
                }
            })
            .catch((err) => {
                console.error('LIFF 初始化失敗:', err);
            });

        // 錄音功能
        function startRecording() {
            liff.sendMessages([{ type: 'text', text: '請錄音' }])
                .then(() => {
                    liff.closeWindow(); // 發送後關閉視窗
                })
                .catch((error) => {
                    console.error('發送訊息失敗:', error);
                    alert('發送失敗，請重試');
                });
        }

        // 提交表單功能
        function submitForm() {
            const summary = document.getElementById('summary').value.trim();
            
            if (!summary) {
                alert('請輸入災情摘要');
                return;
            }
            
            // 發送到 Google Apps Script
            fetch('https://script.google.com/macros/s/AKfycbxxPnPQ7JkgASlIhZDSc2cjykYHH_mF046uTP0kJ71MGLxvphK5hJcTscb00ifehgVplw/exec', {
                method: 'POST',
                body: JSON.stringify({ summary: summary })
            })
            .then(response => response.text())
            .then(result => {
                console.log('提交成功:', result);
                alert('回報成功！');
                liff.closeWindow(); // 提交後關閉視窗
            })
            .catch(error => {
                console.error('提交失敗:', error);
                alert('回報失敗，請重試');
            });
        }
    </script>
</body>
</html>