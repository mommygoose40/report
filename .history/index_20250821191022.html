<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½æƒ…å›å ±</title>
    <script src="https://static.line-scdn.net/liff/edge/versions/2.22.3/sdk.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #06c755;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        input {
            padding: 10px;
            margin: 10px 0;
            width: 80%;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ç½æƒ…å›å ±</h1>
    
    <!-- éŒ„éŸ³æŒ‰éˆ• -->
    <button onclick="startRecording()">ğŸ¤ éŒ„éŸ³</button>
    <br>
    
    <!-- æ–‡å­—æ‘˜è¦è¼¸å…¥æ¡† -->
    <input type="text" id="summary" placeholder="è«‹è¼¸å…¥ç½æƒ…æ‘˜è¦ï¼ˆ20å­—å…§ï¼‰" maxlength="20">
    <br>
    
    <!-- æäº¤æŒ‰éˆ• -->
    <button onclick="submitForm()">ğŸ“¤ æäº¤</button>

    <script>
        // LIFF åˆå§‹åŒ–
        liff.init({ liffId: '2007934728-xN6aOL3D' }) // å‹™å¿…æ›æˆæ‚¨çš„ LIFF ID
            .then(() => {
                console.log('LIFF åˆå§‹åŒ–æˆåŠŸ');
                if (!liff.isLoggedIn()) {
                    liff.login(); // å¦‚æœæœªç™»å…¥ï¼Œå°è‡³ç™»å…¥
                }
            })
            .catch((err) => {
                console.error('LIFF åˆå§‹åŒ–å¤±æ•—:', err);
            });

        // éŒ„éŸ³åŠŸèƒ½
        function startRecording() {
            liff.sendMessages([{ type: 'text', text: 'è«‹éŒ„éŸ³' }])
                .then(() => {
                    liff.closeWindow(); // ç™¼é€å¾Œé—œé–‰è¦–çª—
                })
                .catch((error) => {
                    console.error('ç™¼é€è¨Šæ¯å¤±æ•—:', error);
                    alert('ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦');
                });
        }

        // æäº¤è¡¨å–®åŠŸèƒ½
        function submitForm() {
            const summary = document.getElementById('summary').value.trim();
            
            if (!summary) {
                alert('è«‹è¼¸å…¥ç½æƒ…æ‘˜è¦');
                return;
            }
            
            // ç™¼é€åˆ° Google Apps Script
            fetch('https://script.google.com/macros/s/AKfycbxxPnPQ7JkgASlIhZDSc2cjykYHH_mF046uTP0kJ71MGLxvphK5hJcTscb00ifehgVplw/exec', {
                method: 'POST',
                body: JSON.stringify({ summary: summary })
            })
            .then(response => response.text())
            .then(result => {
                console.log('æäº¤æˆåŠŸ:', result);
                alert('å›å ±æˆåŠŸï¼');
                liff.closeWindow(); // æäº¤å¾Œé—œé–‰è¦–çª—
            })
            .catch(error => {
                console.error('æäº¤å¤±æ•—:', error);
                alert('å›å ±å¤±æ•—ï¼Œè«‹é‡è©¦');
            });
        }
    </script>
</body>
</html>